
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>平台福利 - 内部入口</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* 背景装饰 */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            animation: float 20s linear infinite;
            pointer-events: none;
        }
        
        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-30px, -30px) rotate(360deg); }
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 25px;
            animation: slideDown 0.8s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .stats-bar {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 12px 20px;
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        /* 机票酒店打车入口样式 */
        .travel-entry {
            background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.1));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255,255,255,0.4);
            border-radius: 20px;
            padding: 16px 20px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            animation: travelEntryFloat 3s ease-in-out infinite;
        }
        
        @keyframes travelEntryFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        
        .travel-entry:hover {
            transform: translateY(-5px) scale(1.02);
            background: linear-gradient(135deg, rgba(255,255,255,0.35), rgba(255,255,255,0.2));
            border-color: rgba(255,255,255,0.6);
            box-shadow: 0 12px 40px rgba(0,0,0,0.2);
        }
        
        .travel-entry:active {
            transform: translateY(-2px) scale(0.98);
        }
        
        .travel-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 2;
        }
        
        .travel-icon {
            font-size: 28px;
            margin-right: 15px;
            animation: travelIconRotate 4s linear infinite;
        }
        
        @keyframes travelIconRotate {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
            100% { transform: rotate(0deg); }
        }
        
        .travel-info {
            flex: 1;
            text-align: left;
        }
        
        .travel-title {
            font-size: 18px;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 2px;
        }
        
        .travel-subtitle {
            font-size: 13px;
            color: rgba(255,255,255,0.85);
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .travel-arrow {
            font-size: 20px;
            color: white;
            font-weight: bold;
            transition: transform 0.3s ease;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .travel-entry:hover .travel-arrow {
            transform: translateX(5px);
        }
        
        .travel-shine {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: travelShine 3s infinite;
            pointer-events: none;
        }
        
        @keyframes travelShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(-50%) translateY(-50%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .stat-item {
            text-align: center;
            color: white;
        }
        
        .stat-number {
            font-size: 18px;
            font-weight: 700;
            display: block;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .platform-section {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            transform: translateY(20px);
            opacity: 0;
            animation: slideUp 0.6s ease-out forwards;
            position: relative;
            overflow: hidden;
        }
        
        .platform-section:nth-child(2) { animation-delay: 0.1s; }
        .platform-section:nth-child(3) { animation-delay: 0.2s; }
        .platform-section:nth-child(4) { animation-delay: 0.3s; }
        
        @keyframes slideUp {
            to { transform: translateY(0); opacity: 1; }
        }
        
        .platform-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .platform-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .platform-info {
            display: flex;
            align-items: center;
        }
        
        .platform-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .platform-icon::after {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            border-radius: inherit;
            z-index: -1;
        }
        
        .meituan .platform-icon {
            background: linear-gradient(135deg, #FFD100 0%, #FFA000 100%);
            color: #333;
        }
        
        .jd .platform-icon {
            background: linear-gradient(135deg, #E1251B 0%, #C62828 100%);
        }
        
        .taobao .platform-icon {
            background: linear-gradient(135deg, #FF6A00 0%, #E65100 100%);
        }
        
        .platform-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        
        .platform-subtitle {
            font-size: 14px;
            color: #666;
            margin-top: 2px;
        }
        
        .platform-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(255,107,107,0.3);
        }
        
        .platform-badge.top {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            animation: glow 2s infinite;
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 2px 8px rgba(255,215,0,0.3); }
            50% { box-shadow: 0 4px 16px rgba(255,215,0,0.6); }
        }
        
        .coupon-grid {
            display: grid;
            gap: 15px;
        }
        
        .meituan .coupon-grid {
            grid-template-columns: 1fr;
        }
        
        .jd .coupon-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .taobao .coupon-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
        
        .coupon-item {
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
            border: 2px solid #e8ebff;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            user-select: none;
        }
        
        .coupon-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .coupon-item:hover::before {
            left: 100%;
        }
        
        .coupon-item:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .coupon-item:active {
            transform: translateY(-1px) scale(0.98);
        }
        
        .meituan .coupon-item {
            background: linear-gradient(135deg, #fff8e1 0%, #fff3c4 100%);
            border-color: #ffd54f;
        }
        
        .jd .coupon-item {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border-color: #ef5350;
        }
        
        .taobao .coupon-item {
            background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 100%);
            border-color: #ff9800;
        }
        
        .coupon-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .coupon-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            flex: 1;
        }
        
        .coupon-amount {
            background: #ff4757;
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .coupon-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .coupon-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .tag {
            display: inline-block;
            color: white;
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .tag.hot {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }
        
        .tag.new {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }
        
        .tag.stack {
            background: linear-gradient(135deg, #45b7d1, #2196F3);
        }
        
        .tag.recommend {
            background: linear-gradient(135deg, #ffa726, #ff9800);
        }
        
        .tag.top {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .coupon-status {
            font-size: 12px;
            color: #999;
            display: flex;
            align-items: center;
        }
        
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #4caf50;
            margin-right: 6px;
            animation: pulse 2s infinite;
        }
        
        .warning {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border: 2px solid #ffb74d;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            font-size: 14px;
            color: #e65100;
            position: relative;
            overflow: hidden;
        }
        
        .warning::before {
            content: '⚠️';
            font-size: 18px;
            margin-right: 8px;
        }
        
        /* 公告弹窗样式 */
        .announcement-modal {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            padding: 20px;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .announcement-content {
            background: linear-gradient(135deg, #fff, #f8f9ff);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            margin: 10% auto;
            position: relative;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: announceSlideIn 0.6s ease-out;
            border: 3px solid #FFD700;
        }
        
        @keyframes announceSlideIn {
            from { transform: translateY(-50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        .announcement-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .announcement-text {
            font-size: 16px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .announcement-highlight {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: 600;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(255,215,0,0.3);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            margin: 20px auto;
            position: relative;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* 针对内容较多的弹窗优化 */
        .modal-content.large-content {
            top: 20px;
            transform: none;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(-50%) scale(0.9); opacity: 0; }
            to { transform: translateY(-50%) scale(1); opacity: 1; }
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        .coupon-code {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            padding: 16px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 14px;
            margin: 20px 0;
            word-break: break-all;
            line-height: 1.5;
            position: relative;
        }
        
        .copy-success {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #4caf50;
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 10px;
            animation: copyPop 0.6s ease-out;
        }
        
        @keyframes copyPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .btn {
            background: linear-gradient(135deg, #007AFF, #0056cc);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 28px;
            font-size: 16px;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,122,255,0.3);
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #0056cc, #003d99);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,122,255,0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            box-shadow: 0 4px 15px rgba(108,117,125,0.3);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #5a6268, #495057);
            box-shadow: 0 6px 20px rgba(108,117,125,0.4);
        }
        
        .btn-gold {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            box-shadow: 0 4px 15px rgba(255,215,0,0.3);
        }
        
        .btn-gold:hover {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            box-shadow: 0 6px 20px rgba(255,215,0,0.4);
        }
        
        .qr-guide {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            border: 2px dashed #ced4da;
        }
        
        .guide-steps {
            display: flex;
            justify-content: space-around;
            margin: 16px 0;
        }
        
        .guide-step {
            text-align: center;
            flex: 1;
        }
        
        .guide-step-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .guide-step-text {
            font-size: 12px;
            color: #666;
        }
        
        .floating-help {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(255,107,107,0.4);
            z-index: 999;
            transition: all 0.3s ease;
        }
        
        .floating-help:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 25px rgba(255,107,107,0.5);
        }
        
        .success-toast {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #4caf50;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            z-index: 1001;
            display: none;
            animation: toastSlide 0.3s ease-out;
        }
        
        @keyframes toastSlide {
            from { transform: translateX(-50%) translateY(-20px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 浏览器提示样式 */
        .browser-warning {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            border: 2px solid #f44336;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            font-size: 14px;
            color: #c62828;
            position: relative;
            overflow: hidden;
        }
        
        .browser-warning::before {
            content: '🚨';
            font-size: 18px;
            margin-right: 8px;
        }
        
        /* 口令复制指引样式 */
        .copy-guide {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            font-size: 14px;
            color: #1565c0;
            text-align: center;
        }
        
        .copy-guide::before {
            content: '📋';
            font-size: 18px;
            margin-right: 8px;
        }
        
        /* 响应式优化 */
        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .platform-section {
                padding: 20px;
                margin-bottom: 15px;
            }
            
            .jd .coupon-grid {
                grid-template-columns: 1fr;
            }
            
            .floating-help {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .announcement-content {
                margin: 5% auto;
                padding: 20px;
            }
            
            /* 移动端弹窗优化 */
            .modal {
                padding: 10px;
            }
            
            .modal-content {
                margin: 10px auto;
                padding: 20px;
                max-width: calc(100vw - 20px);
                max-height: calc(100vh - 40px);
            }
            
            .modal-content.large-content {
                top: 10px;
                margin-top: 10px;
                margin-bottom: 10px;
                max-height: calc(100vh - 20px);
            }
            
            /* 二维码图片在移动端的优化 */
            #qrCodeImage, #qrPlaceholder, #elemeQrCodeImage, #elemePlaceholder {
                max-width: 160px !important;
                max-height: 160px !important;
                width: 160px !important;
                height: 160px !important;
            }
            
            /* 机票入口移动端优化 */
            .travel-entry {
                padding: 14px 16px;
                margin: 15px 0;
            }
            
            .travel-title {
                font-size: 16px;
            }
            
            .travel-subtitle {
                font-size: 12px;
            }
            
            .travel-icon {
                font-size: 24px;
                margin-right: 12px;
            }
            
            .travel-arrow {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- 公告弹窗 -->
    <div id="announcementModal" class="announcement-modal">
        <div class="announcement-content">
            <div class="announcement-title">🔥【重要更新 & 限时福利】</div>
            <div class="announcement-text">
                <strong>8月2日 美团外卖大额红包</strong> 火热开抢！别错过！<br><br>
                <strong>✨ 重磅新增三大优惠：</strong><br>
                ✈️ <strong>机票立减100元！</strong> (无门槛)<br>
                🏡 <strong>民宿立减100元！</strong> (无门槛)<br>
                🚕 <strong>打车免单机会！</strong> 入口已开放！
            </div>
            <div class="announcement-highlight">
                ⚠️ 重要提醒：淘宝需要在默认浏览器中打开，否则无法跳转！
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeAnnouncement()">我知道了</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>🍜 第三次外卖大战，史高！！！</h1>
            <p>集合三大平台所有员工优惠入口</p>
            
            <!-- 机票酒店打车优惠入口 -->
            <div class="travel-entry" onclick="openTravelPage()">
                <div class="travel-content">
                    <div class="travel-icon">✈️</div>
                    <div class="travel-info">
                        <div class="travel-title">机票 · 酒店 · 打车</div>
                        <div class="travel-subtitle">专属优惠通道</div>
                    </div>
                    <div class="travel-arrow">→</div>
                </div>
                <div class="travel-shine"></div>
            </div>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <span class="stat-number" id="totalCoupons">15+</span>
                    <span class="stat-label">优惠券</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalSaved">999+</span>
                    <span class="stat-label">已省金额</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="activeUsers">10k+</span>
                    <span class="stat-label">活跃用户</span>
                </div>
            </div>
        </div>
        
        <!-- 淘系外卖 - 现在在第一位 -->
        <div class="platform-section taobao">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon">淘宝</div>
                    <div>
                        <div class="platform-title">淘系外卖</div>
                        <div class="platform-subtitle">阿里生态</div>
                    </div>
                </div>
                <div class="platform-badge top">置顶推荐</div>
            </div>
            
            <!-- 浏览器提示 -->
            <div class="browser-warning" id="browserWarning" style="display: none;">
                检测到您在微信环境！为保证正常跳转，请点击右上角...选择用默认浏览器中打开本页面。
            </div>
            
            <div class="coupon-grid">
                <!-- 注意：以下三个链接需要用户提供具体地址 -->
                <div class="coupon-item" onclick="openTaobaoEntry1()">
                    <div class="coupon-header">
                        <div class="coupon-title">🧋 淘宝闪购0.01喝奶茶</div>
                        <div class="coupon-amount">最高15元</div>
                    </div>
                    <div class="coupon-desc">领最高15元大额红包，0.01元喝奶茶</div>
                    <div class="coupon-footer">
                        <span class="tag top">置顶</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            可用
                        </div>
                    </div>
                </div>
                <div class="coupon-item" onclick="openTaobaoEntry2()">
                    <div class="coupon-header">
                        <div class="coupon-title">🆓 新客免单</div>
                        <div class="coupon-amount">首单免单</div>
                    </div>
                    <div class="coupon-desc">闪购新用户可领首单免单福利</div>
                    <div class="coupon-footer">
                        <span class="tag new">新客</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            可用
                        </div>
                    </div>
                </div>
                <div class="coupon-item" onclick="openTaobaoEntry3()">
                    <div class="coupon-header">
                        <div class="coupon-title">🎁 淘宝叠加红包</div>
                        <div class="coupon-amount">可叠加</div>
                    </div>
                    <div class="coupon-desc">闪购新用户可领首单免单福利</div>
                    <div class="coupon-footer">
                        <span class="tag stack">可叠加</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            可用
                        </div>
                    </div>
                </div>
                
                <!-- 饿了么18.8极限暴涨保持不变 -->
                <div class="warning">
                    💡 省钱攻略：三个入口都能领取，建议全部领取后叠加使用，享受最大优惠！
                </div>
                
                <div class="coupon-item" onclick="openElemeExtreme()" style="margin-top: 16px;">
                    <div class="coupon-header">
                        <div class="coupon-title">💥 饿了么18.8极限暴涨</div>
                        <div class="coupon-amount">18.8元</div>
                    </div>
                    <div class="coupon-desc">极限优惠，限时抢购，独立活动，必中入口</div>
                    <div class="coupon-footer">
                        <span class="tag hot">爆款</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            限时
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copy-guide" id="copyGuide" style="display: none;">
                检测到无法跳转！口令已自动复制到剪切板，请手动打开淘宝App粘贴使用。
            </div>
        </div>
        
        <!-- 美团外卖 - 现在移到第二位 -->
        <div class="platform-section meituan">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon">美团</div>
                    <div>
                        <div class="platform-title">美团外卖</div>
                        <div class="platform-subtitle">大额通用</div>
                    </div>
                </div>
                <div class="platform-badge">HOT</div>
            </div>
            <div class="coupon-grid">
                <div class="coupon-item" onclick="openMeituanFestival()">
                    <div class="coupon-header">
                        <div class="coupon-title">🎉 美团外卖节</div>
                        <div class="coupon-amount">最高66元</div>
                    </div>
                    <div class="coupon-desc">15-15/25-20不定时掉落</div>
                    <div class="coupon-footer">
                        <span class="tag hot">热门</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            进行中
                        </div>
                    </div>
                </div>
                <div class="coupon-item" onclick="openMeituanAutumnTea()">
                    <div class="coupon-header">
                        <div class="coupon-title">🍂 秋天第一杯奶茶</div>
                        <div class="coupon-amount">限购2份</div>
                    </div>
                    <div class="coupon-desc">每人每日限购2份，秋日暖心特惠</div>
                    <div class="coupon-footer">
                        <span class="tag hot">限购</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            每日限量
                        </div>
                    </div>
                </div>
                <div class="coupon-item" onclick="openMeituanDiscount()">
                    <div class="coupon-header">
                        <div class="coupon-title">💰 一折吃外卖</div>
                        <div class="coupon-amount">最高90%</div>
                    </div>
                    <div class="coupon-desc">可与外卖节红包叠加使用</div>
                    <div class="coupon-footer">
                        <span class="tag stack">可叠加</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            限时
                        </div>
                    </div>
                </div>
                <div class="coupon-item" onclick="openMeituanGiftPack()">
                    <div class="coupon-header">
                        <div class="coupon-title">🎁 9.9购600元红包</div>
                        <div class="coupon-amount">600元</div>
                    </div>
                    <div class="coupon-desc">新BUG入口，限时</div>
                    <div class="coupon-footer">
                        <span class="tag new">限时</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            有效
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 京东外卖 - 保持第三位 -->
        <div class="platform-section jd">
            <div class="platform-header">
                <div class="platform-info">
                    <div class="platform-icon">京东</div>
                    <div>
                        <div class="platform-title">京东外卖</div>
                        <div class="platform-subtitle">品质保障</div>
                    </div>
                </div>
                <div class="platform-badge">推荐</div>
            </div>
            <div class="coupon-grid">
                <div class="coupon-item" onclick="openJDGeneral()">
                    <div class="coupon-header">
                        <div class="coupon-title">🛍️ 京东大包</div>
                    </div>
                    <div class="coupon-desc">员工专用大额包</div>
                    <div class="coupon-footer">
                        <span class="tag recommend">推荐</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            可用
                        </div>
                    </div>
                </div>
                <div class="coupon-item" onclick="openJDTea()">
                    <div class="coupon-header">
                        <div class="coupon-title">🧋 奶茶入口</div>
                    </div>
                    <div class="coupon-desc">奶茶专属优惠</div>
                    <div class="coupon-footer">
                        <span class="tag hot">热门</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            可用
                        </div>
                    </div>
                </div>
                <div class="coupon-item" onclick="openJDCoffee()">
                    <div class="coupon-header">
                        <div class="coupon-title">☕ 库迪咖啡</div>
                    </div>
                    <div class="coupon-desc">咖啡品牌优惠</div>
                    <div class="coupon-footer">
                        <span class="tag new">品牌</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            可用
                        </div>
                    </div>
                </div>
                <div class="coupon-item" onclick="openJDNight()">
                    <div class="coupon-header">
                        <div class="coupon-title">🌙 宵夜入口</div>
                    </div>
                    <div class="coupon-desc">小龙虾16.8元</div>
                    <div class="coupon-footer">
                        <span class="tag stack">限时</span>
                        <div class="coupon-status">
                            <div class="status-dot"></div>
                            可用
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 悬浮帮助按钮 -->
    <div class="floating-help" onclick="showHelp()">
        <span>?</span>
    </div>
    
    <!-- 成功提示 -->
    <div id="successToast" class="success-toast">
        操作成功！正在跳转...
    </div>
    
    <!-- 口令复制弹窗 -->
    <div id="couponModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">🎁 口令已复制成功</div>
            <div class="coupon-code" id="couponCode">
                <div class="copy-success" style="display: none;">已复制</div>
            </div>
            <div style="color: #666; margin-bottom: 20px;" id="couponHint">请粘贴到相应App中使用</div>
            <button class="btn btn-secondary" onclick="closeCouponModal()">我知道了</button>
            <button class="btn" onclick="openTargetApp()" id="openAppBtn">
                <span class="loading" id="appLoading" style="display: none;"></span>
                打开应用
            </button>
        </div>
    </div>
    
    <!-- 扫码引导弹窗 -->
    <div id="qrModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">📱 微信扫码使用</div>
            <div class="qr-guide">
                <p style="margin-bottom: 16px;">请长按保存/截图下方二维码图片，使用微信扫码功能扫描</p>
                
                <!-- 二维码图片显示区域 -->
                <div style="text-align: center; margin: 20px 0; background: #f5f5f5; padding: 20px; border-radius: 12px;">
                    <img id="qrCodeImage" src="./1.jpg" alt="一折吃外卖二维码" style="max-width: 200px; max-height: 200px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" onerror="this.style.display='none'; document.getElementById('qrPlaceholder').style.display='flex';">
                    <div id="qrPlaceholder" style="display: none; width: 200px; height: 200px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 8px; margin: 0 auto; align-items: center; justify-content: center; color: white; font-size: 14px; text-align: center;">
                        请将1.jpg二维码图片<br>放在同目录下
                    </div>
                </div>
                
                <div class="guide-steps">
                    <div class="guide-step">
                        <div class="guide-step-icon">📷</div>
                        <div class="guide-step-text">长按保存/截图</div>
                    </div>
                    <div class="guide-step">
                        <div class="guide-step-icon">🔍</div>
                        <div class="guide-step-text">微信扫一扫</div>
                    </div>
                    <div class="guide-step">
                        <div class="guide-step-icon">🖼️</div>
                        <div class="guide-step-text">从相册选择</div>
                    </div>
                    <div class="guide-step">
                        <div class="guide-step-icon">✅</div>
                        <div class="guide-step-text">完成领取</div>
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 12px; border-radius: 8px; margin-top: 16px; font-size: 13px; color: #1976d2;">
                    💡 提示：先领取上方外卖节红包，再跳转微信打开点击【领大额卷】可叠加，返现到您下单账号。
                </div>
            </div>
            <button class="btn" onclick="closeQRModal()">我知道了</button>
        </div>
    </div>
    
    <!-- 帮助弹窗 -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">💡 使用帮助</div>
            <div style="text-align: left; line-height: 1.6; color: #666;">
                <p><strong>📱 如何使用：</strong></p>
                <p>• 点击优惠券卡片即可领取</p>
                <p>• 部分优惠券可以叠加使用</p>
                <p>• 建议先领取再下单</p>
                <br>
                <p><strong>⚠️ 注意事项：</strong></p>
                <p>• 优惠券有使用时限</p>
                <p>• 部分活动仅限新用户</p>
                <p>• 微信环境下请在浏览器打开</p>
                <p>• 淘宝入口必须使用默认浏览器</p>
            </div>
            <button class="btn" onclick="closeHelpModal()">知道了</button>
        </div>
    </div>

    <!-- 跳转失败解决方案弹窗 -->
    <div id="failureModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">🚫 跳转失败解决方案</div>
            <div id="failureContent" style="text-align: left; line-height: 1.6; color: #666;">
                <!-- 动态内容 -->
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeFailureModal()">知道了</button>
                <button class="btn" id="retryBtn" onclick="retryLastAction()">重试</button>
                <button class="btn" id="fallbackBtn" onclick="useFallbackMethod()" style="display: none;">备用方案</button>
            </div>
        </div>
    </div>

    <!-- 饿了么18.8极限暴涨扫码弹窗 -->
    <div id="elemeExtremeModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">💥 饿了么18.8极限暴涨</div>
            <div class="qr-guide">
                <p style="margin-bottom: 16px;">请长按保存/截图下方二维码图片，使用微信扫码功能扫描</p>
                
                <!-- 二维码图片显示区域 -->
                <div style="text-align: center; margin: 20px 0; background: #f5f5f5; padding: 20px; border-radius: 12px;">
                    <img id="elemeQrCodeImage" src="./2.jpg" alt="饿了么18.8极限暴涨二维码" style="max-width: 200px; max-height: 200px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" onerror="this.style.display='none'; document.getElementById('elemePlaceholder').style.display='flex';">
                    <div id="elemePlaceholder" style="display: none; width: 200px; height: 200px; background: linear-gradient(135deg, #ff6b6b, #ee5a52); border-radius: 8px; margin: 0 auto; align-items: center; justify-content: center; color: white; font-size: 14px; text-align: center;">
                        请将2.jpg二维码图片<br>放在同目录下
                    </div>
                </div>
                
                <div class="guide-steps">
                    <div class="guide-step">
                        <div class="guide-step-icon">📷</div>
                        <div class="guide-step-text">长按保存/截图</div>
                    </div>
                    <div class="guide-step">
                        <div class="guide-step-icon">🔍</div>
                        <div class="guide-step-text">微信扫一扫</div>
                    </div>
                    <div class="guide-step">
                        <div class="guide-step-icon">🖼️</div>
                        <div class="guide-step-text">从相册选择</div>
                    </div>
                    <div class="guide-step">
                        <div class="guide-step-icon">✅</div>
                        <div class="guide-step-text">完成领取</div>
                    </div>
                </div>
                
                <div style="background: #ffebee; padding: 12px; border-radius: 8px; margin-top: 16px; font-size: 13px; color: #c62828;">
                    🔥 限时活动：18.8元极限优惠，手慢无！
                </div>
                
                <div style="background: #e3f2fd; padding: 12px; border-radius: 8px; margin-top: 8px; font-size: 13px; color: #1976d2;">
                    💡 提示：限时膨胀18.8，必爆18.8元
                </div>
            </div>
            <button class="btn" onclick="document.getElementById('elemeExtremeModal').style.display='none'; document.querySelector('#elemeExtremeModal .modal-content').classList.remove('large-content');">我知道了</button>
        </div>
    </div>

    <div id="manualModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">📋 手动操作指南</div>
            <div id="manualContent" style="text-align: left; line-height: 1.6; color: #666;">
                <!-- 动态内容 -->
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeManualModal()">我知道了</button>
                <button class="btn" onclick="copyManualLink()">复制链接</button>
            </div>
        </div>
    </div>

    <script>
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            animateStats();
            updateOnlineStatus();
            checkBrowserEnvironment();
            // 不自动显示公告，等用户交互后显示
        });
        
        // 打开机票酒店打车优惠页面
        function openTravelPage() {
            showSuccessToast('正在跳转到机票酒店打车优惠页面...');
            
            setTimeout(() => {
                // 尝试在新标签页打开
                const newWindow = window.open('https://jp.nft3g.com', '_blank');
                
                // 检测是否成功打开新窗口
                setTimeout(() => {
                    if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                        // 如果弹窗被阻止，直接跳转
                        window.location.href = 'https://jp.nft3g.com';
                    }
                }, 1000);
            }, 300);
        }
        
        // 检查浏览器环境
        function checkBrowserEnvironment() {
            const isWeixin = /micromessenger/i.test(navigator.userAgent);
            const isStandaloneBrowser = window.navigator.standalone !== undefined || 
                                      /safari/i.test(navigator.userAgent) || 
                                      /chrome/i.test(navigator.userAgent);
            
            if (isWeixin || !isStandaloneBrowser) {
                document.getElementById('browserWarning').style.display = 'block';
            }
        }
        
        // 关闭公告弹窗
        function closeAnnouncement() {
            const modal = document.getElementById('announcementModal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }
        }
        
        // 统计数据动画
        function animateStats() {
            const counters = document.querySelectorAll('.stat-number');
            counters.forEach(counter => {
                const target = parseInt(counter.textContent);
                const duration = 2000;
                const increment = target / (duration / 16);
                let current = 0;
                
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    counter.textContent = Math.floor(current) + (counter.id === 'totalCoupons' ? '+' : counter.id === 'activeUsers' ? 'k+' : '+');
                }, 16);
            });
        }
        
        // 更新在线状态
        function updateOnlineStatus() {
            const dots = document.querySelectorAll('.status-dot');
            dots.forEach(dot => {
                dot.style.background = navigator.onLine ? '#4caf50' : '#ff5722';
            });
        }
        
        // 显示成功提示
        function showSuccessToast(message) {
            const toast = document.getElementById('successToast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
        
        // 检测是否在微信环境
        function isWeixinBrowser() {
            return /micromessenger/i.test(navigator.userAgent);
        }
        
        // 存储当前操作信息
        let currentAction = null;
        let fallbackLinks = {};
        let currentCouponType = 'taobao'; // 默认淘宝
        
        // 检测跳转是否成功
        function detectJumpFailure(timeout = 2000) {
            return new Promise((resolve) => {
                let resolved = false;
                const startTime = Date.now();
                
                // 页面失焦检测（可能跳转成功）
                const onBlur = () => {
                    if (!resolved) {
                        resolved = true;
                        cleanup();
                        resolve(true);
                    }
                };
                
                // 页面重新获得焦点（可能跳转失败）
                const onFocus = () => {
                    setTimeout(() => {
                        if (!resolved && (Date.now() - startTime) > 1000) {
                            resolved = true;
                            cleanup();
                            resolve(false);
                        }
                    }, 300);
                };
                
                // 页面可见性变化
                const onVisibilityChange = () => {
                    if (document.hidden && !resolved) {
                        resolved = true;
                        cleanup();
                        resolve(true);
                    }
                };
                
                // 超时处理
                const timeoutId = setTimeout(() => {
                    if (!resolved) {
                        resolved = true;
                        cleanup();
                        resolve(false); // 超时认为跳转失败
                    }
                }, timeout);
                
                const cleanup = () => {
                    clearTimeout(timeoutId);
                    window.removeEventListener('blur', onBlur);
                    window.removeEventListener('focus', onFocus);
                    document.removeEventListener('visibilitychange', onVisibilityChange);
                };
                
                // 添加事件监听
                window.addEventListener('blur', onBlur);
                window.addEventListener('focus', onFocus);
                document.addEventListener('visibilitychange', onVisibilityChange);
            });
        }
        
        // 复制到剪贴板并显示指引
        function copyToClipboardWithGuide(couponText, platform = 'taobao') {
            console.log('正在复制口令:', couponText); // 调试日志
            
            // 先复制到剪切板
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(couponText).then(() => {
                    console.log('使用现代API复制成功');
                    showCopyGuideAndToast(platform, couponText);
                }).catch((error) => {
                    console.error('现代API复制失败:', error);
                    // 复制失败，使用备用方法
                    fallbackCopy(couponText);
                    showCopyGuideAndToast(platform, couponText);
                });
            } else {
                console.log('使用备用复制方法');
                // 使用备用复制方法
                fallbackCopy(couponText);
                showCopyGuideAndToast(platform, couponText);
            }
        }
        
        // 备用复制方法
        function fallbackCopy(text) {
            console.log('执行备用复制，内容:', text);
            
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-9999px';
            textArea.style.top = '-9999px';
            textArea.style.opacity = '0';
            textArea.setAttribute('readonly', '');
            
            document.body.appendChild(textArea);
            
            // 选择文本
            textArea.focus();
            textArea.select();
            textArea.setSelectionRange(0, text.length);
            
            try {
                const success = document.execCommand('copy');
                console.log('execCommand复制结果:', success);
                if (!success) {
                    throw new Error('execCommand复制失败');
                }
            } catch (err) {
                console.error('备用复制失败:', err);
                // 最后尝试手动选择
                try {
                    textArea.select();
                    document.execCommand('copy');
                } catch (e) {
                    console.error('所有复制方法都失败了:', e);
                }
            }
            
            document.body.removeChild(textArea);
        }
        
        // 显示复制指引和提示
        function showCopyGuideAndToast(platform, couponText) {
            console.log('显示指引，口令内容:', couponText);
            
            // 安全处理口令文本，避免HTML注入和JavaScript错误
            const safeCouponText = couponText.replace(/'/g, '&#39;').replace(/"/g, '&quot;');
            const plainCouponText = couponText.replace(/'/g, "\\'").replace(/"/g, '\\"');
            
            // 显示页面内的指引
            const guide = document.getElementById('copyGuide');
            if (guide) {
                guide.innerHTML = `
                    📋 检测到无法跳转！口令已自动复制到剪切板<br>
                    <strong>请按以下步骤操作：</strong><br>
                    1️⃣ 手动打开淘宝App<br>
                    2️⃣ 在搜索框粘贴口令<br>
                    3️⃣ 点击搜索即可领取优惠<br>
                    <div style="background: #f0f0f0; padding: 8px; border-radius: 6px; margin-top: 8px; font-family: monospace; font-size: 12px; word-break: break-all; user-select: all; cursor: pointer;" onclick="copyToClipboard('${plainCouponText}'); showSuccessToast('口令已重新复制！');" title="点击重新复制">
                        ${safeCouponText}
                    </div>
                `;
                guide.style.display = 'block';
                
                // 滚动到指引位置
                guide.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            // 显示成功提示
            showSuccessToast('🎉 口令已复制！请打开淘宝App粘贴使用');
            
            // 3秒后显示详细指引弹窗
            setTimeout(() => {
                showDetailedCopyGuide(platform, couponText);
            }, 2000);
        }
        
        // 显示详细的复制指引弹窗
        function showDetailedCopyGuide(platform, couponText) {
            const modal = document.getElementById('couponModal');
            const title = modal.querySelector('.modal-title');
            const code = document.getElementById('couponCode');
            const hint = document.getElementById('couponHint');
            const btn = document.getElementById('openAppBtn');
            
            title.innerHTML = '📋 跳转失败 - 口令已复制';
            code.textContent = couponText;
            code.style.userSelect = 'all'; // 允许用户选择文本
            code.onclick = function() {
                copyToClipboard(couponText);
                showSuccessToast('口令已重新复制！');
            };
            
            hint.innerHTML = `
                <div style="text-align: left; line-height: 1.6;">
                    <strong>📱 手动操作步骤：</strong><br>
                    1. 打开淘宝App<br>
                    2. 点击搜索框<br>
                    3. 长按粘贴上方口令<br>
                    4. 点击搜索领取优惠<br><br>
                    <strong style="color: #ff6b6b;">💡 口令已自动复制，直接粘贴即可</strong><br>
                    <strong style="color: #666;">点击上方口令框可重新复制</strong>
                </div>
            `;
            btn.innerHTML = '<span class="loading" id="appLoading" style="display: none;"></span>打开淘宝App';
            
            modal.style.display = 'block';
        }
        
        // 淘宝闪购0.01喝奶茶
        function openTaobaoEntry1() {
            currentAction = { platform: 'taobao', type: 'entry1' };
            currentCouponType = 'taobao';
            
            const couponCode = '98 HU7405   2:/₤dJDY4XF5GXt十领最高15元大额红包';
            const targetUrl = 'tbopen://m.taobao.com/tbopen/index.html?&action=ali.open.nav&module=h5&h5Url=https%3A%2F%2Fh5.ele.me%2Fminisite%2Fpages%2Findex-xsd%2Findex%3FisTab%3Dfalse%26disableNav%3DYES%26forceThemis%3Dtrue%26tfPos%3Dh5%26forbidRefineType%3DgoOut%26from%3Dminiapp.taobao%26channelInfo%3D%257B%2522subSubChannel%2522%253A%2522miniapp.taobao.et%2522%257D%26alsc_exsrc%3DES0006299852%26mdFrom%3D%26scene%3D0cb4d5747999412bb3be591eed7c76f7';
            
            console.log('淘宝闪购入口1 - 口令:', couponCode);
            showSuccessToast('正在尝试跳转淘宝闪购0.01喝奶茶...');
            
            // 隐藏之前的复制指引
            const guide = document.getElementById('copyGuide');
            if (guide) guide.style.display = 'none';
            
            // 尝试跳转
            attemptJumpToTaobao(targetUrl);
            
            // 3秒后直接显示口令弹窗
            setTimeout(() => {
                showCouponDialog('淘宝闪购0.01喝奶茶', couponCode);
            }, 3000);
        }
        
        // 新客免单
        function openTaobaoEntry2() {
            currentAction = { platform: 'taobao', type: 'entry2' };
            currentCouponType = 'taobao';
            
            const couponCode = '57 HU7405   2:/OmOQ4XFUD8j✔四闪购新用户可领首单免单福利';
            const targetUrl = 'tbopen://m.taobao.com/tbopen/index.html?&action=ali.open.nav&module=h5&h5Url=https%3A%2F%2Fh5.ele.me%2Fminisite%2Fpages%2Findex-sgyx%2Findex%3Ffrom%3Dminiapp.taobao%26channelInfo%3D%257B%2522subSubChannel%2522%253A%2522miniapp.taobao.et%2522%257D%26alsc_exsrc%3DES0007076172%26disableNav%3DYES%26forbidRefineType%3DgoOut%26forceThemis%3Dtrue%26tfPos%3Dh5%26isTab%3Dfalse%26scene%3D0edcda3442b944219d4944f35cf78009';
            
            console.log('新客免单入口2 - 口令:', couponCode);
            showSuccessToast('正在尝试跳转新客免单...');
            
            const guide = document.getElementById('copyGuide');
            if (guide) guide.style.display = 'none';
            
            attemptJumpToTaobao(targetUrl);
            
            setTimeout(() => {
                showCouponDialog('新客免单', couponCode);
            }, 3000);
        }
        
        // 淘宝叠加红包
        function openTaobaoEntry3() {
            currentAction = { platform: 'taobao', type: 'entry3' };
            currentCouponType = 'taobao';
            
            const couponCode = '47 HU7405   2:/M8Ky4XF74F5三闪购新用户可领首单免单福利';
            const targetUrl = 'tbopen://m.taobao.com/tbopen/index.html?&action=ali.open.nav&module=h5&h5Url=https%3A%2F%2Fm.duanqu.com%2F%3F_ariver_appid%3D8251537%26page%3Dplugin-private%253A%252F%252F2021003183669766%252Fpages%252Fwh-coupon-guide%252Findex%253Ffrom%253Dminiapp.taobao%2526channelInfo%253D%257B%2522subSubChannel%2522%253A%2522miniapp.taobao.et%2522%257D%2526alsc_exsrc%253DES0007485972%2526scene%253D587327319bf047f4a6cc7636d8a85d86';
            
            console.log('淘宝叠加红包入口3 - 口令:', couponCode);
            showSuccessToast('正在尝试跳转淘宝叠加红包...');
            
            const guide = document.getElementById('copyGuide');
            if (guide) guide.style.display = 'none';
            
            attemptJumpToTaobao(targetUrl);
            
            setTimeout(() => {
                showCouponDialog('淘宝叠加红包', couponCode);
            }, 3000);
        }
        
        // 统一的淘宝跳转尝试方法
        function attemptJumpToTaobao(targetUrl) {
            console.log('尝试跳转到:', targetUrl);
            
            // 使用iframe方法尝试跳转
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = targetUrl;
            document.body.appendChild(iframe);
            
            // 同时尝试直接跳转
            setTimeout(() => {
                try {
                    window.location.href = targetUrl;
                } catch (e) {
                    console.log('直接跳转失败，使用iframe方法');
                }
            }, 100);
            
            // 3秒后清理iframe
            setTimeout(() => {
                if (iframe && iframe.parentNode) {
                    iframe.parentNode.removeChild(iframe);
                }
            }, 3500);
        }
        
        // 显示口令对话框（简化版）
        function showCouponDialog(entryName, couponCode) {
            const modal = document.getElementById('couponModal');
            const title = modal.querySelector('.modal-title');
            const code = document.getElementById('couponCode');
            const hint = document.getElementById('couponHint');
            const openAppBtn = document.getElementById('openAppBtn');
            
            // 清理之前可能存在的按钮区域
            const existingButtons = document.getElementById('jumpConfirmButtons');
            if (existingButtons) {
                existingButtons.remove();
            }
            
            title.innerHTML = `📋 ${entryName} - 口令复制`;
            code.style.display = 'block';
            openAppBtn.style.display = 'inline-block';
            
            // 尝试自动复制口令
            attemptCopyText(couponCode).then((success) => {
                code.textContent = couponCode;
                code.style.userSelect = 'all';
                code.style.backgroundColor = success ? '#e8f5e8' : '#fff3cd';
                code.style.borderColor = success ? '#28a745' : '#ffc107';
                code.style.cursor = 'pointer';
                code.onclick = function() { 
                    attemptCopyText(couponCode).then(result => {
                        showSuccessToast(result ? '✅ 口令复制成功！' : '❌ 复制失败，请手动选择复制');
                    });
                };
                
                const statusText = success ? 
                    '<strong style="color: #28a745;">✅ 口令已自动复制到剪切板！</strong>' :
                    '<strong style="color: #ff6b6b;">⚠️ 自动复制失败，请点击上方口令框手动复制</strong>';
                
                hint.innerHTML = `
                    <div style="text-align: center; line-height: 1.8; margin-bottom: 15px;">
                        ${statusText}
                    </div>
                    <div style="text-align: left; line-height: 1.6; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>📱 使用步骤：</strong><br>
                        1. ${success ? '直接' : '点击上方口令框复制，然后'}打开淘宝App<br>
                        2. 在搜索框中粘贴口令<br>
                        3. 点击搜索领取优惠券<br><br>
                        <div style="color: #666; font-size: 13px;">
                            💡 如果跳转成功请忽略此弹窗<br>
                            💡 点击上方口令框可重新复制
                        </div>
                    </div>
                `;
                
                openAppBtn.innerHTML = '<span class="loading" id="appLoading" style="display: none;"></span>打开淘宝App';
                
                // 同时显示页面内指引
                showSimplePageGuide(success, couponCode);
                
                // 显示提示
                const toastText = success ? 
                    '🎉 口令已自动复制！请打开淘宝App粘贴使用' : 
                    '⚠️ 请手动复制口令！点击上方口令框进行复制';
                showSuccessToast(toastText);
            });
            
            modal.style.display = 'block';
        }
        
        // 简化的文本复制函数
        function attemptCopyText(text) {
            return new Promise((resolve) => {
                console.log('开始复制文本:', text);
                
                // 方法1: 现代API
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text).then(() => {
                        console.log('现代API复制成功');
                        resolve(true);
                    }).catch(() => {
                        console.log('现代API失败，尝试传统方法');
                        resolve(tryLegacyCopy(text));
                    });
                } else {
                    console.log('不支持现代API，使用传统方法');
                    resolve(tryLegacyCopy(text));
                }
            });
        }
        
        // 传统复制方法
        function tryLegacyCopy(text) {
            try {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.top = '50%';
                textArea.style.left = '50%';
                textArea.style.transform = 'translate(-50%, -50%)';
                textArea.style.width = '300px';
                textArea.style.height = '100px';
                textArea.style.fontSize = '14px';
                textArea.style.border = '2px solid #007AFF';
                textArea.style.borderRadius = '8px';
                textArea.style.padding = '10px';
                textArea.style.zIndex = '10000';
                textArea.setAttribute('readonly', '');
                
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                textArea.setSelectionRange(0, text.length);
                
                const success = document.execCommand('copy');
                console.log('传统方法复制结果:', success);
                
                setTimeout(() => {
                    document.body.removeChild(textArea);
                }, 200);
                
                return success;
            } catch (err) {
                console.error('传统复制方法失败:', err);
                return false;
            }
        }
        
        // 显示简化的页面内指引
        function showSimplePageGuide(copySuccess, couponText) {
            const guide = document.getElementById('copyGuide');
            if (guide) {
                const safeCouponText = couponText.replace(/'/g, '&#39;').replace(/"/g, '&quot;');
                const plainCouponText = couponText.replace(/'/g, "\\'").replace(/"/g, '\\"');
                
                const statusText = copySuccess ? 
                    '✅ 口令已自动复制到剪切板！' : 
                    '❌ 自动复制失败，请手动复制下方口令';
                
                guide.innerHTML = `
                    📋 ${statusText}<br>
                    <strong>请按以下步骤操作：</strong><br>
                    1️⃣ ${copySuccess ? '直接' : '复制下方口令，然后'}打开淘宝App<br>
                    2️⃣ 在搜索框粘贴口令<br>
                    3️⃣ 点击搜索即可领取优惠<br>
                    <div style="background: ${copySuccess ? '#e8f5e8' : '#fff3cd'}; padding: 12px; border-radius: 8px; margin-top: 10px; font-family: monospace; font-size: 13px; word-break: break-all; user-select: all; cursor: pointer; border: 2px solid ${copySuccess ? '#28a745' : '#ffc107'};" onclick="attemptCopyText('${plainCouponText}').then(r => showSuccessToast(r ? '口令复制成功！' : '复制失败，请手动选择'));" title="点击复制口令">
                        <div style="font-size: 11px; color: #666; margin-bottom: 5px;">👆 点击下方口令复制</div>
                        <strong>${safeCouponText}</strong>
                    </div>
                `;
                guide.style.display = 'block';
                guide.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // 检测是否可以打开应用
        function canOpenApp(scheme, timeout = 2500) {
            return new Promise((resolve) => {
                let resolved = false;
                const startTime = Date.now();
                
                // 页面失焦检测（表示可能跳转成功）
                const onBlur = () => {
                    if (!resolved) {
                        resolved = true;
                        cleanup();
                        resolve(true);
                    }
                };
                
                // 页面重新获得焦点（可能跳转失败）
                const onFocus = () => {
                    setTimeout(() => {
                        if (!resolved && (Date.now() - startTime) > 1000) {
                            resolved = true;
                            cleanup();
                            resolve(false);
                        }
                    }, 300);
                };
                
                // 超时处理
                const timeoutId = setTimeout(() => {
                    if (!resolved) {
                        resolved = true;
                        cleanup();
                        resolve(false);
                    }
                }, timeout);
                
                const cleanup = () => {
                    clearTimeout(timeoutId);
                    window.removeEventListener('blur', onBlur);
                    window.removeEventListener('focus', onFocus);
                    if (iframe && iframe.parentNode) {
                        iframe.parentNode.removeChild(iframe);
                    }
                };
                
                // 添加事件监听
                window.addEventListener('blur', onBlur);
                window.addEventListener('focus', onFocus);
                
                // 尝试打开应用
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = scheme;
                document.body.appendChild(iframe);
                
                // 同时尝试直接跳转（某些浏览器更有效）
                try {
                    window.location.href = scheme;
                } catch (e) {
                    console.log('Direct navigation failed, using iframe method');
                }
            });
        }
        
        // 饿了么18.8极限暴涨 - 保持不变
        function openElemeExtreme() {
            currentAction = { platform: 'eleme', type: 'extreme' };
            
            showSuccessToast('正在打开饿了么18.8极限暴涨...');
            
            setTimeout(() => {
                const elemeModal = document.getElementById('elemeExtremeModal');
                const elemeModalContent = elemeModal.querySelector('.modal-content');
                elemeModalContent.classList.add('large-content');
                elemeModal.style.display = 'block';
            }, 500);
        }
        
        // 秋天第一杯奶茶
        function openMeituanAutumnTea() {
            currentAction = { platform: 'meituan', type: 'autumntea' };
            currentCouponType = 'meituan';
            fallbackLinks.meituan = 'https://5kma.cn/7EI28I';
            
            console.log('正在打开秋天第一杯奶茶入口...');
            showSuccessToast('正在跳转到秋天第一杯奶茶（每日限购2份）...');
            
            // 多种跳转方式确保成功
            setTimeout(() => {
                try {
                    // 方法1: 新窗口打开
                    const newWindow = window.open('https://5kma.cn/7EI28I', '_blank');
                    console.log('尝试新窗口打开:', newWindow);
                    
                    // 方法2: 如果新窗口被阻止，直接跳转
                    setTimeout(() => {
                        if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                            console.log('新窗口被阻止，尝试直接跳转');
                            window.location.href = 'https://5kma.cn/7EI28I';
                        }
                    }, 800);
                    
                    // 方法3: 检查跳转是否成功
                    setTimeout(() => {
                        if (!newWindow || newWindow.closed) {
                            console.log('跳转可能失败，显示解决方案');
                            showFailureSolution('meituan', 'autumntea');
                        }
                    }, 2000);
                    
                } catch (error) {
                    console.error('跳转过程中出错:', error);
                    // 出错时直接跳转
                    window.location.href = 'https://5kma.cn/7EI28I';
                }
            }, 300);
        }
        
        // 美团外卖节 - 保持原有功能
        function openMeituanFestival() {
            currentAction = { platform: 'meituan', type: 'festival' };
            currentCouponType = 'meituan';
            fallbackLinks.meituan = 'http://dpurl.cn/9o4N4z1z';
            
            showSuccessToast('正在跳转到美团外卖节...');
            
            if (isWeixinBrowser()) {
                setTimeout(() => {
                    const newWindow = window.open('http://dpurl.cn/9o4N4z1z', '_blank');
                    setTimeout(() => {
                        if (!newWindow || newWindow.closed) {
                            showFailureSolution('meituan', 'festival');
                        }
                    }, 1000);
                }, 500);
            } else {
                const deeplink = 'imeituan://www.meituan.com/takeout/browser?inner_url=https%3A%2F%2Fclick.meituan.com%2Ft%3Ft%3D1%26c%3D2%26p%3DFxiu1L9zHdcF&lch=cps:mtlm:10:b9831c934ad648519d5bf0be5e24eaad:3592876ff339ce3770d6:7:1696797023346810929';
                
                setTimeout(() => {
                    canOpenApp(deeplink).then(success => {
                        if (!success) {
                            const newWindow = window.open('http://dpurl.cn/9o4N4z1z', '_blank');
                            setTimeout(() => {
                                if (!newWindow || newWindow.closed) {
                                    showFailureSolution('meituan', 'festival');
                                }
                            }, 1000);
                        }
                    });
                }, 500);
            }
        }
        
        // 一折吃外卖 - 保持原有功能
        function openMeituanDiscount() {
            currentAction = { platform: 'meituan', type: 'discount' };
            fallbackLinks.meituan = 'https://wxaurl.cn/kvDXEXXyCnq';
            
            showSuccessToast('正在打开一折外卖二维码...');
            
            setTimeout(() => {
                const qrModal = document.getElementById('qrModal');
                const qrModalContent = qrModal.querySelector('.modal-content');
                qrModalContent.classList.add('large-content');
                qrModal.style.display = 'block';
            }, 500);
        }
        
        // 9.9购买600元红包 - 保持原有功能
        function openMeituanGiftPack() {
            currentAction = { platform: 'meituan', type: 'giftpack' };
            currentCouponType = 'meituan';
            
            const coupon = '1 %复制信息#% 打开团App http:/💰eqMDQzOTk0NTU💰一起领';
            
            copyToClipboard(coupon).then(() => {
                document.getElementById('couponCode').textContent = coupon;
                document.getElementById('couponHint').textContent = '请粘贴到美团App中使用';
                document.getElementById('openAppBtn').innerHTML = '<span class="loading" id="appLoading" style="display: none;"></span>打开美团';
                document.getElementById('couponModal').style.display = 'block';
                showSuccessToast('口令已复制到剪贴板！');
            }).catch(() => {
                document.getElementById('couponCode').textContent = coupon;
                document.getElementById('couponModal').style.display = 'block';
                showFailureSolution('meituan', 'giftpack');
            });
        }
        
        // 京东外卖功能保持不变
        function openJDGeneral() {
            currentAction = { platform: 'jingdong', type: 'general' };
            fallbackLinks.jingdong = 'https://kzurl11.cn/7Cdjjb';
            
            showSuccessToast('正在跳转到京东外卖...');
            setTimeout(() => {
                const newWindow = window.open('https://kzurl11.cn/7Cdjjb', '_blank');
                setTimeout(() => {
                    if (!newWindow || newWindow.closed) {
                        showFailureSolution('jingdong', 'general');
                    }
                }, 1500);
            }, 500);
        }
        
        function openJDTea() {
            currentAction = { platform: 'jingdong', type: 'tea' };
            fallbackLinks.jingdong = 'https://kzurl17.cn/7CdBjq';
            
            showSuccessToast('正在跳转到奶茶优惠...');
            setTimeout(() => {
                const newWindow = window.open('https://kzurl17.cn/7CdBjq', '_blank');
                setTimeout(() => {
                    if (!newWindow || newWindow.closed) {
                        showFailureSolution('jingdong', 'tea');
                    }
                }, 1500);
            }, 500);
        }
        
        function openJDCoffee() {
            currentAction = { platform: 'jingdong', type: 'coffee' };
            fallbackLinks.jingdong = 'https://kzurl11.cn/7CdV97';
            
            showSuccessToast('正在跳转到库迪咖啡...');
            setTimeout(() => {
                const newWindow = window.open('https://kzurl11.cn/7CdV97', '_blank');
                setTimeout(() => {
                    if (!newWindow || newWindow.closed) {
                        showFailureSolution('jingdong', 'coffee');
                    }
                }, 1500);
            }, 500);
        }
        
        function openJDNight() {
            currentAction = { platform: 'jingdong', type: 'night' };
            fallbackLinks.jingdong = 'https://kzurl07.cn/7CdVFi';
            
            showSuccessToast('正在跳转到宵夜优惠...');
            setTimeout(() => {
                const newWindow = window.open('https://kzurl07.cn/7CdVFi', '_blank');
                setTimeout(() => {
                    if (!newWindow || newWindow.closed) {
                        showFailureSolution('jingdong', 'night');
                    }
                }, 1500);
            }, 500);
        }
        
        // 复制到剪贴板
        function copyToClipboard(text) {
            console.log('copyToClipboard被调用，内容:', text);
            
            if (!text || text.trim() === '') {
                console.error('复制内容为空');
                showSuccessToast('❌ 复制失败：内容为空');
                return Promise.reject('内容为空');
            }
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                return navigator.clipboard.writeText(text).then(() => {
                    console.log('现代API复制成功:', text);
                    showCopySuccess();
                }).catch((error) => {
                    console.error('现代API复制失败:', error);
                    // 使用备用方法
                    return fallbackCopySimple(text);
                });
            } else {
                console.log('不支持现代API，使用备用方法');
                return fallbackCopySimple(text);
            }
        }
        
        // 简单的备用复制方法
        function fallbackCopySimple(text) {
            console.log('fallbackCopySimple被调用，内容:', text);
            
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-9999px';
            textArea.style.top = '-9999px';
            textArea.style.opacity = '0';
            textArea.setAttribute('readonly', '');
            
            document.body.appendChild(textArea);
            
            try {
                textArea.focus();
                textArea.select();
                textArea.setSelectionRange(0, text.length);
                
                const success = document.execCommand('copy');
                console.log('execCommand结果:', success);
                
                if (success) {
                    showCopySuccess();
                    return Promise.resolve();
                } else {
                    throw new Error('execCommand返回false');
                }
            } catch (err) {
                console.error('备用复制失败:', err);
                showSuccessToast('❌ 复制失败，请手动复制');
                return Promise.reject(err);
            } finally {
                document.body.removeChild(textArea);
            }
        }
        
        // 显示复制成功提示
        function showCopySuccess() {
            const indicator = document.querySelector('.copy-success');
            if (indicator) {
                indicator.style.display = 'block';
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 2000);
            }
        }
        
        // 显示跳转失败解决方案
        function showFailureSolution(platform, actionType) {
            const modal = document.getElementById('failureModal');
            const content = document.getElementById('failureContent');
            const retryBtn = document.getElementById('retryBtn');
            const fallbackBtn = document.getElementById('fallbackBtn');
            
            let solutionHtml = '';
            
            switch (platform) {
                case 'meituan':
                    solutionHtml = `
                        <p><strong>🔧 美团外卖跳转失败解决方案：</strong></p>
                        <p>1. <strong>检查美团App</strong>：确保已安装最新版美团App</p>
                        <p>2. <strong>手动打开</strong>：打开美团App → 外卖 → 搜索"优惠券"</p>
                        <p>3. <strong>浏览器访问</strong>：使用备用网页版链接</p>
                        <p>4. <strong>微信用户</strong>：点击右上角"..."选择浏览器打开</p>
                        <br>
                        <p><strong>💡 推荐解决方法：</strong></p>
                        <p>点击下方"备用方案"使用网页版链接</p>
                    `;
                    fallbackBtn.style.display = 'inline-block';
                    break;
                    
                case 'jingdong':
                    solutionHtml = `
                        <p><strong>🔧 京东外卖跳转失败解决方案：</strong></p>
                        <p>1. <strong>检查京东App</strong>：确保已安装京东App</p>
                        <p>2. <strong>直接访问</strong>：在浏览器中打开备用链接</p>
                        <p>3. <strong>手动操作</strong>：打开京东App → 搜索"外卖优惠"</p>
                        <p>4. <strong>网络检查</strong>：确保网络连接正常</p>
                        <br>
                        <p><strong>💡 推荐解决方法：</strong></p>
                        <p>京东外卖链接通常比较稳定，点击重试即可</p>
                    `;
                    fallbackBtn.style.display = 'none';
                    break;
                    
                case 'taobao':
                    solutionHtml = `
                        <p><strong>🔧 淘宝外卖跳转失败解决方案：</strong></p>
                        <p>1. <strong>使用默认浏览器</strong>：Safari/Chrome等浏览器打开</p>
                        <p>2. <strong>退出微信</strong>：如在微信中，请选择浏览器打开</p>
                        <p>3. <strong>检查淘宝App</strong>：确保已安装淘宝App</p>
                        <p>4. <strong>口令已复制</strong>：请手动打开淘宝App粘贴使用</p>
                        <br>
                        <p><strong>⚠️ 特别提醒：</strong></p>
                        <p>淘宝入口必须在默认浏览器中使用，口令已自动复制</p>
                    `;
                    fallbackBtn.style.display = 'none';
                    break;
            }
            
            content.innerHTML = solutionHtml;
            modal.style.display = 'block';
        }
        
        function showHelp() {
            document.getElementById('helpModal').style.display = 'block';
        }
        
        // 关闭弹窗
        function closeCouponModal() {
            document.getElementById('couponModal').style.display = 'none';
        }
        
        function closeQRModal() {
            const qrModal = document.getElementById('qrModal');
            const qrModalContent = qrModal.querySelector('.modal-content');
            qrModalContent.classList.remove('large-content');
            qrModal.style.display = 'none';
        }
        
        function closeHelpModal() {
            document.getElementById('helpModal').style.display = 'none';
        }
        
        function closeFailureModal() {
            document.getElementById('failureModal').style.display = 'none';
        }
        
        function closeManualModal() {
            document.getElementById('manualModal').style.display = 'none';
        }
        
        // 重试上次操作
        function retryLastAction() {
            closeFailureModal();
            if (!currentAction) return;
            
            const { platform, type } = currentAction;
            
            if (platform === 'taobao') {
                switch (type) {
                    case 'entry1':
                        openTaobaoEntry1();
                        break;
                    case 'entry2':
                        openTaobaoEntry2();
                        break;
                    case 'entry3':
                        openTaobaoEntry3();
                        break;
                }
            } else if (platform === 'meituan') {
                switch (type) {
                    case 'festival':
                        openMeituanFestival();
                        break;
                    case 'autumntea':
                        openMeituanAutumnTea();
                        break;
                    case 'discount':
                        openMeituanDiscount();
                        break;
                    case 'giftpack':
                        openMeituanGiftPack();
                        break;
                }
            } else if (platform === 'jingdong') {
                switch (type) {
                    case 'general':
                        openJDGeneral();
                        break;
                    case 'tea':
                        openJDTea();
                        break;
                    case 'coffee':
                        openJDCoffee();
                        break;
                    case 'night':
                        openJDNight();
                        break;
                }
            }
        }
        
        // 使用备用方案
        function useFallbackMethod() {
            closeFailureModal();
            if (!currentAction) return;
            
            const platform = currentAction.platform;
            const fallbackUrl = fallbackLinks[platform];
            
            if (fallbackUrl) {
                showSuccessToast('正在使用备用方案跳转...');
                setTimeout(() => {
                    const newWindow = window.open(fallbackUrl, '_blank');
                    if (!newWindow || newWindow.closed) {
                        setTimeout(() => {
                            showManualGuide(platform, currentAction.type);
                        }, 1000);
                    }
                }, 500);
            } else {
                showManualGuide(platform, currentAction.type);
            }
        }
        
        // 显示手动操作指南
        function showManualGuide(platform, actionType) {
            const modal = document.getElementById('manualModal');
            const content = document.getElementById('manualContent');
            
            let guideHtml = '';
            
            switch (platform) {
                case 'meituan':
                    guideHtml = `
                        <p><strong>📱 美团外卖手动操作步骤：</strong></p>
                        <ol style="padding-left: 20px;">
                            <li>打开美团App</li>
                            <li>点击首页"外卖"入口</li>
                            <li>在搜索框输入"红包"或"优惠券"</li>
                            <li>查找外卖节活动入口</li>
                            <li>领取相应优惠券</li>
                        </ol>
                        <br>
                        <p><strong>🔗 备用网页链接：</strong></p>
                        <p style="background: #f0f0f0; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; word-break: break-all;">
                            ${fallbackLinks.meituan || 'http://dpurl.cn/9o4N4z1z'}
                        </p>
                        <p><strong>🍂 奶茶专用链接：</strong></p>
                        <p style="background: #f0f0f0; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; word-break: break-all;">
                            https://5kma.cn/7EI28I (每日限购2份)
                        </p>
                    `;
                    break;
                    
                case 'taobao':
                    guideHtml = `
                        <p><strong>📱 淘宝外卖手动操作步骤：</strong></p>
                        <ol style="padding-left: 20px;">
                            <li>确保在默认浏览器中打开（重要！）</li>
                            <li>打开淘宝App</li>
                            <li>在搜索框粘贴已复制的口令</li>
                            <li>按提示完成优惠券领取</li>
                            <li>享受超值优惠</li>
                        </ol>
                        <br>
                        <p><strong>💡 温馨提示：</strong></p>
                        <p style="background: #e3f2fd; padding: 10px; border-radius: 5px; font-size: 12px; color: #1565c0;">
                            口令已自动复制到剪切板，直接在淘宝中粘贴即可使用
                        </p>
                    `;
                    break;
            }
            
            content.innerHTML = guideHtml;
            modal.style.display = 'block';
        }
        
        // 复制手动链接
        function copyManualLink() {
            if (!currentAction) return;
            
            const platform = currentAction.platform;
            const linkToCopy = fallbackLinks[platform];
            
            if (linkToCopy) {
                copyToClipboard(linkToCopy).then(() => {
                    showSuccessToast('链接已复制到剪贴板！');
                    closeManualModal();
                }).catch(() => {
                    alert('复制失败，请手动复制链接');
                });
            }
        }
        
        // 打开目标App
        function openTargetApp() {
            const loading = document.getElementById('appLoading');
            if (loading) loading.style.display = 'inline-block';
            
            setTimeout(() => {
                if (loading) loading.style.display = 'none';
                
                if (currentCouponType === 'meituan') {
                    // 尝试多种方式打开美团
                    const meituanSchemes = [
                        'imeituan://www.meituan.com',
                        'meituan://',
                        'com.sankuai.meituan://'
                    ];
                    
                    meituanSchemes.forEach((scheme, index) => {
                        setTimeout(() => {
                            try {
                                window.location.href = scheme;
                            } catch (e) {
                                console.log(`美团跳转方案${index + 1}失败`);
                            }
                        }, index * 200);
                    });
                    
                } else if (currentCouponType === 'taobao') {
                    // 尝试多种方式打开淘宝
                    const taobaoSchemes = [
                        'taobao://',
                        'tbopen://m.taobao.com',
                        'com.taobao.taobao://'
                    ];
                    
                    taobaoSchemes.forEach((scheme, index) => {
                        setTimeout(() => {
                            try {
                                window.location.href = scheme;
                            } catch (e) {
                                console.log(`淘宝跳转方案${index + 1}失败`);
                            }
                        }, index * 200);
                    });
                }
                
                // 3秒后关闭弹窗
                setTimeout(() => {
                    closeCouponModal();
                }, 3000);
                
            }, 1000);
        }
        
        // 点击弹窗外部关闭
        window.onclick = function(event) {
            const modals = ['couponModal', 'qrModal', 'helpModal', 'failureModal', 'manualModal', 'elemeExtremeModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    if (modalId === 'qrModal' || modalId === 'elemeExtremeModal') {
                        const modalContent = modal.querySelector('.modal-content');
                        modalContent.classList.remove('large-content');
                    }
                    modal.style.display = 'none';
                }
            });
        }
        
        // 监听网络状态变化
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        // 页面可见性变化时更新状态
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                updateOnlineStatus();
            }
        });
    </script>
</body>
</html>